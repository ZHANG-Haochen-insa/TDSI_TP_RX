# X射线成像实验

## 实验准备

您可以使用一个X射线图像采集设备。同时配有不同的物体/样品：
- **物体0** = 无
- **物体1** = 纸板阶梯
- **物体2** = 小球
- **物体3** = 铝制阶梯
- **物体4** = 泡沫
- **物体5** = 核桃

## A. 工具的熟悉操作

1. 打开"学生"会话
2. 打开X射线发生器并启动X射线管的预热（参考文档 `.\documentation\TutoRX.pdf`，幻灯片2-3）
3. 启动PSL Viewer（桌面快捷方式）
4. 点击"camera setup"，然后禁用自动处理以获得以下配置（即不进行"background"和"flat field"校正）
6. 在"Exposure"中选择采集时间
7. 要获得"实时"图像，使用对应的按钮

**开始吧！**

---

## 图示说明

### 图1：实验中使用的一些样品
- (a) 到 (e) 不同的样品

### 图2：实验台的一些组成元素的放大图

### 图3：图像的特征区域
- 蓝色虚线：样品外的区域
- 红色实线：样品架后面的区域
- **注意**：这里使用了物体(e)，但区域的定义独立于所选物体

---

## 理论回顾

相机测量的信号 **s(x,y)** 与到达探测器平面的X射线光子数 **n(x,y)** 成正比。此外，n由比尔-朗伯定律给出：

$$n(x,y) = n_0 \exp\left(-\int \mu(x,y) \, dl\right) \quad \text{(1)}$$

其中：
- **n₀** 是入射到物体上的光子数
- **μ** 是物体的衰减系数

---

## B. 第一批图像

### B.1 
定位X射线管、探测器、样品架和X射线管供电装置。

### B.2 
将物体(a)放置在样品架上，注意确认其高度位置正确（25mm，见图2b）。同时检查X射线管-探测器和X射线管-样品架的距离（参考导轨上的黄色标记，如上面的照片a所示）。

### B.3 
预选择X射线管电压（"beam voltage"）为30 kV，电流（"beam current"）为250 mA。操作方法：按住"set"按钮。

### B.4 
选择1秒的采集时间（PSL > Camera setup > Exposure）

### B.5 
启动"X-Rays ON/OFF"，X射线管连续发射。

**⚠️ 警告**：一般来说，在整个实验过程中，当您不在采集阶段时，请务必关闭X射线管（以保护探测器免受辐射）

---

## 问题开始

### [Q1] 
观察获得的图像，注意理解它们的可视化方式（对应按钮）。保存一张图像，命名为 **Q1.tif**。

**注意**：如果您的图像是"黑色"的，现在是思考的时候了，打开您的图像查看记录的数值。在实验期间，您有两个Python程序（`code_etu.py` 和 `code_2_etu.py`）需要完成。

### [Q2] 
对比度的物理起源是什么？

---

## C. X射线管电流和积分时间

### [Q3] 
改变采集时间从100 ms到4s（例如100、500、1000、2000和4000 ms）。为此，您可以参考 `.\macro_acqui\simpleExample.txt` 编写采集宏（参见 `.\documentation\PSLViewerManual.pdf`，特别是"Macro control"部分第27-32页的expose和saveas）。要启动宏，选择MacroControl窗口，然后start macro > simpleExample.txt > start。

- 将您的宏保存为txt格式，命名为 **Q3_macro.txt**
- 将图像保存为tif格式，命名为：
  - **Q3_0100.tif**
  - **Q3_0500.tif**
  - **Q3_1000.tif**
  - **Q3_2000.tif**
  - **Q3_4000.tif**

### [Q4] 
根据公式(1)，采集时间对测量的光子数应该有什么影响？提出一个非常简单的定律（尽可能简单），将测量值s与采集时间t联系起来。

### [Q5] 
前一个问题提出的定律在样品架后面（参见图3的实线矩形）是否有效？考虑到样品架强烈衰减X射线，您预期在图像的这个区域测量到什么值？实际上测量到了什么？

### [Q6] 
我们寻求校正前一个问题中发现的效应。提出一种校正方法，该方法将基于采集几张额外的图像，您将保存并命名为 **Q5_*.tif**（用您选择的字符串替换"*"）。您必须返回Python代码并完成Q6单元格。

### [Q7] 
通过验证校正后的图像与积分时间成正比来验证您的校正。为此，在两张采集的图像之间进行除法（例如t = 4s和t = 1s）。完成Python代码。保存校正后的图像（**Q7_1000ms.tif** 和 **Q7_4000ms.tif**）以及除法结果（**Q7_div.tif**），并对其进行评论。

---

## D. 平场校正（flat field correction）

### [Q8] 
评论校正图像 Q7_1000ms.tif 和 Q7_4000ms.tif 在样品外部（参见图3）的外观（即空间变化）。您观察到什么，如何从物理上解释？

### [Q9] 
如何校正这种效应？提出一种校正程序，该程序基于在没有物体的情况下采集的额外图像。提示：记住公式(1)给出的图像形成模型。如何消除空间变化的探测增益？

### [Q10] 
保存没有物体时采集的图像（命名为 **Q9_1000ms.tif**），然后通过Python代码中的函数实现[Q9]的校正程序。您将保存您的宏以及两张平场校正后的图像（即"flat field"校正的结果），命名为 **Q10_1000ms.tif** 和 **Q10_2000ms.tif**。

---

## E. 比尔-朗伯定律

### [Q11] 
我们寻求进行一次采集，使我们能够验证公式(1)给出的比尔-朗伯定律。我们特别寻求实验验证衰减 ∫μ(x,y)dl 的演变。为此，我们决定使用已知材料的不同厚度进行采集。选择哪个物体？

### [Q11b] 
保存采集的图像（命名为 **Q11.tif**）及其平场校正图像（**Q11_b.tif**）。

**注意**：将X射线管电压固定为30 kV，电流为250 mA。不要移动物体，这将便于后续处理。

### [Q12] 
表示测量的衰减与台阶厚度的关系。为此，您将从 `meanMultipleRois_etu.py` 代码开始，对其进行调整和完善。保存平场校正后的台阶图像（**Q12.tif**）以及结果图表（**Q12_plot.tif**）。

### [Q13] 
评论衰减随厚度的演变。

### [Q14] 
估算纸板的质量衰减系数τ（单位：cm²/g）。回顾关系式 **μ = τρ**，其中μ是线性衰减系数（单位：cm⁻¹），ρ是质量密度（单位：g/cm³）。假设纸板的克重为240 g/m²。台阶厚度的数值（记为Δx）不需要知道就可以计算τ。

### [Q15] 
与理论值比较，并推导出"有效"采集能量。使用XmuDat（File > Data setup > Add > Cellulose Acetate，Rel. Weight = 1，OK，OK 以可视化质量衰减系数，File > Save Data 以记录数值）

---

## F. X射线管电压的影响

对25、20和15 kV的电压进行同样的操作。

**注意**：不要移动物体，这将便于后续处理。

### [Q17] 
观察平场校正后获得的图像。发生了什么？如何校正这个问题？采集额外的图像（命名为 **Q17_15kV.tif**、**Q17_20kV.tif** 和 **Q17_25kV.tif**）以解决这个问题。

### [Q18] 
评论衰减随能量的演变。

---

**版本日期：2023年12月11日**

**文档页数：7/7**
